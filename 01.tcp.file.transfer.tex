\documentclass{article}
\usepackage{listings}
% Language setting
% Replace `english' with e.g. `spanish' to change the document language
\usepackage[english]{babel}

% Set page size and margins
% Replace `letterpaper' with `a4paper' for UK/EU standard size
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}

\title{Practical 1}
\author{Truong Gia Huy}

\begin{document}
\maketitle



\section{Protocol}
\begin{figure}[h!]
    \centering
    \includegraphics[width=1\linewidth]{Screenshot 2024-03-25 103509.png}
    \caption{Protocol}
    \label{fig:enter-label}
\end{figure}
\begin{enumerate}
    \item Protocol Architecture: Client-server model
    \item Connection Establishment:\\
     Client send connection request to server\\
     Server responds with acknowledgment \\
     Client send final acknowledgment  to complete the connection \\
    \item Data transfer:\\
     Upload:\\
        Client divides the file into smaller packets.\\
        Each packet is assigned a sequence number.\\
        Client sends the packets to the server.\\
        Server acknowledges each packet received.\\
        If an acknowledgment is not received, the client retransmits the packet.\\
     Download:\\
        Server sends the file data in packets.\\
        Each packet is assigned a sequence number.\\
        Client acknowledges each packet received.\\
        If an acknowledgment is not received, the server retransmits the packet.
\end{enumerate}



\section{Implement the file transfer}
\begin{enumerate}
    \item Server:\\
    \begin{lstlisting}
    void send_file(int sockfd, char *filename) {
    char buff[MAX];
    int fd = open(filename, O_RDONLY);
    if (fd < 0) {
        printf("Error opening file.\n");
        return;
    }

    while (1) {
        int bytes_read = read(fd, buff, MAX);
        if (bytes_read <= 0) break;
        write(sockfd, buff, bytes_read);
    }
    close(fd);
}

\end{lstlisting}
This code will read the file and copy its to buffer.After that the file from buffer go through socket to client.
    \item Client:
    \begin{lstlisting}
        void receive_file(int sockfd, char *filename) {
    char buff[MAX];
    int fd = open(filename, O_WRONLY | O_CREAT | O_TRUNC, 0666);
    if (fd < 0) {
        printf("Error creating/opening file.\n");
        return;
    }

    while (1) {
        int bytes_read = read(sockfd, buff, MAX);
        if (bytes_read <= 0) break;
        write(fd, buff, bytes_read);
    }
    close(fd);
}
    \end{lstlisting}
This code will take the code sent from buffer through socket and read that file.
\end{enumerate}




\end{document}